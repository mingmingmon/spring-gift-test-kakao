# USING_AI.md - AI 활용 문서

## 1. 어떤 질문을 했는가

### Q1. 프로젝트 분석 및 핵심 행동 식별 요청

> "핵심 행동 식별을 해서 project-analysis.md라는 파일을 만들어줘.
> 프로젝트 구조, 계층 구조, 도메인 모델, 엔티티 정보, 사용 가능한 API,
> 프로젝트 내부적으로 이상한 점이나 결함이라고 의심되는 부분도 포함해줘"

- CLAUDE.md의 Step 1(핵심 행동 식별)을 수행하기 위한 사전 작업으로, 프로젝트 전체 분석을 먼저 요청
- 단순히 행동 목록만이 아니라, 프로젝트 구조와 결함까지 포함하도록 범위를 확장

### Q2. TEST_STRATEGY.md 작성 요청

> "지금까지의 내용으로 TEST_STRATEGY.md 작성해줘"

- project-analysis.md의 분석 결과를 기반으로, CLAUDE.md가 요구하는 테스트 전략 문서 작성을 요청

### Q3. 테스트 데이터 격리 전략 심화 요청

> "test_strategy.md에서 테스트 데이터 전략 수립에 대해 조금 더 고민해보자.
> 다시 한 번 검토하고 좀 더 구체적으로 격리 전략을 제안하고 그 이유를 말해줘"

- Claude의 초안이 `@DirtiesContext 또는 @BeforeEach DB 초기화`라고만 적혀 있어 구체성이 부족하다고 판단
- 4가지 격리 전략 후보(DirtiesContext, Repository deleteAll, SQL TRUNCATE, 고유 데이터)를 비교 분석하도록 요청

### Q4. main 패키지 수정 없이 격리 구현 요청

> "DatabaseCleaner는 main 패키지에서 코드를 추가해야 되는거야?
> test 패키지 내부에서만 테스트 코드를 작성하는 경우만 가능하다고 한다면
> 어떻게 다른 방법을 선택해야 돼?"

- Claude가 제안한 `@Component DatabaseCleaner`가 main 패키지에 테스트 전용 코드를 넣는 문제를 지적
- 제약 조건(test 패키지 내부에서만 해결)을 명시하고 대안을 요청

---

## 2. Claude의 제안을 어떻게 검증/수정했는가

### 2.1 핵심 행동 목록 수정

Claude는 최초 6개의 핵심 행동을 제안했다:

| # | Claude 원안 | 최종 |
|---|------------|------|
| 1 | 카테고리 생성 | 유지 |
| 2 | 상품 생성 | 유지 |
| 3 | 상품 조회 | 유지 |
| 4 | 선물하기 (재고 차감) | 유지 |
| 5 | 선물하기 실패 (재고 부족) | 유지 |
| 6 | 존재하지 않는 리소스 참조 시 실패 | **삭제** |

**수정 이유**: 6번 항목("존재하지 않는 리소스 참조 시 실패")은 별도의 핵심 행동으로 분리하기보다, 각 시나리오의 실패 케이스 안에서 자연스럽게 다루는 것이 적절하다고 판단하여 제거. 예를 들어 "존재하지 않는 카테고리로 상품 생성 실패"는 상품 생성 시나리오의 실패 케이스로 포함됨.

### 2.2 테스트 데이터 격리 전략 수정 (2회)

**1차 수정 - 격리 전략 구체화**

Claude 초안은 격리 전략을 한 줄로만 언급했다:
> `@DirtiesContext 또는 @BeforeEach에서 DB 초기화`

이를 4가지 후보 전략으로 비교 분석하도록 요청했고, Claude는 전략 C(SQL TRUNCATE + DatabaseCleaner)를 제안했다.

**2차 수정 - main 패키지 수정 금지 제약 추가**

Claude의 DatabaseCleaner 제안은 `@Component`로 main 패키지에 배치하는 구조였다. 이는 테스트 전용 코드가 프로덕션 코드에 섞이는 문제가 있어, "test 패키지 내부에서만 해결해야 한다"는 제약을 추가했다.

Claude는 두 가지 대안을 제시했고, 최종적으로 더 단순한 방식을 선택했다:

| 대안 | 설명 | 최종 |
|------|------|------|
| `@TestConfiguration` + DatabaseCleaner 클래스 | test 패키지에 별도 클래스 + Bean 설정 | 탈락 (보일러플레이트 과다) |
| BaseAcceptanceTest + `@BeforeEach` 직접 TRUNCATE | 부모 클래스에서 JdbcTemplate으로 직접 처리 | **채택** |

**채택 이유**: 엔티티 5개, 테스트 클래스 3개 규모에서 JPA 메타모델 자동화나 별도 클래스 분리는 오버엔지니어링. 부모 클래스 한 곳에서 테이블 5개를 TRUNCATE하는 것이 가장 명확하고 유지보수가 쉬움.
